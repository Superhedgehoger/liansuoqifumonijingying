# 加油站汽服门店经营模拟器

这是一个“加油站 + 汽服门店”连锁经营模拟项目：用可配置的站点客流、门店服务线、项目目录、库存与薪酬规则，按天模拟经营数据（收入/成本/毛利/经营利润/净现金流），并提供 WebUI + React 新前端用于配置与分析。

## 适用场景

- 快速搭建一个可跑通的汽服门店经营沙盘：建设期 CAPEX、折旧、固定开销、库存扣减、薪酬与提成、盈亏平衡。
- 作为“连锁经营/选址/门店效率”类原型：多站点、多门店对比，地图分析视图辅助筛选。
- 作为运营/财务口径讨论载体：用可解释的模型把提成、成本、毛利、现金流拆开看。

## 核心能力

- 多站点/多门店：站点产生加油车与访客客流，门店基于转化率生成订单。
- 服务线与项目：洗车/维保/洗美/其他分类；支持服务线按项目组合（project mix）生成维保项目。
- 库存与耗材：库存采购入库；接单时扣减耗材/配件；支持“严格配件库存”缺货不接单。
- 成本与利润：变动成本 + 配件 COGS + 折旧 + 固定开销 -> 经营利润；同时计算净现金流。
- 薪酬体系：
  - 固定薪酬（日摊）
  - 提成口径可配置：洗车/维保/洗美可按“收入 or 毛利”，配件可按“配件收入 or 配件毛利”
  - 工时提成：按项目“工时收入占比”拆分工时收入并计提（门店可配置工时单价 `labor_hour_price`）
  - 支持月末阶梯奖、利润分红（按月结算）
- 报表与导出：
  - `data/ledger.csv` 每天每店追加一行明细
  - `/download/state`、`/download/ledger`、`/download/payroll` 支持直接下载
- 地图分析：站点 marker/热力图/卫星视图；按类型/地市/片区/服务商分组筛选与定位。

## 项目结构（简版）

- 后端（Python）：`src/simgame/`
  - 引擎：`src/simgame/engine.py`
  - Web API：`src/simgame/webapp.py`（FastAPI）
  - 存储：`src/simgame/storage.py`（`data/state.json` + `data/ledger.csv` + `data/snapshots/`）
- 新前端（React/Vite）：`simulator/`（通过 `/api/*` 与 `/download/*` 访问后端）

## 快速开始

- 安装后端依赖：`pip install -r requirements.txt`
- 启动后端 Web：`python web_run.py`（或 `python web_launch.py`）
- 启动新前端：在 `simulator/` 下执行 `npm install`、`npm run dev`
- 一键启动：双击 `start_dev.bat`（后端 + 前端）或 `start.bat`

## 关键数据文件

- `data/state.json`：当前存档（可持续编辑与继续模拟）
- `data/ledger.csv`：经营流水（按天/店追加）
- `data/snapshots/`：每日快照（用于回退/重置）
