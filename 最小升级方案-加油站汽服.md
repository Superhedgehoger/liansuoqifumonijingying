# 最小升级方案：加油站汽服门店（盈亏平衡优先）

目标：把现有 CLI 原型升级成“加油站内汽服门店”的最小可用模拟版本，重点跑通 **建设→开业→日结/月结→盈亏平衡**，并把 **人员薪酬体系** 与业务强绑定。

不做（先刻意不做复杂）：城市级人流仿真、真实 GIS、竞品博弈、多门店调度。

---

## 1. 场景设定（你描述的关键约束）

- 客流来源：主要依托加油站车辆流量
  - 分两类：`加油车辆`（主） + `访客`（极少，可作为可选小增量）
  - 汽服成交 = `车辆流量 × 转化率 × 容量/排队约束`
- 门店类型（同一站点可有多个业态或择一）：
  - `自动洗车`：设备折旧高、人工低、吞吐高
  - `人工洗车`：人工高、吞吐受限、客单中
  - `综合汽服`：技术工时+耗材/配件+库存管理，客单高但波动大

---

## 2. 最小版本范围（v0.2 建议）

**只做 1 个站点、1 个门店组合**（可以是单业态或多业态并存），把财务模型做扎实。

功能闭环：

1. 建设期（CAPEX 与开业时间）
   - 设备/装修投入（一次性或分期）
   - 建设天数；未开业期间无收入、可有固定支出（可选）
2. 开业期（按天结算）
   - 站点流量输入（可手动或用简单随机波动）
   - 按业态计算销量、收入、变动成本、毛利
   - 扣除人工、折旧、固定费用
3. 报表
   - 日报：销量/收入/毛利/净利润/现金流
   - 月报：汇总、盈亏平衡指标（BEQ/回本期）
4. 薪酬体系
   - 角色、底薪、提成/计件、绩效奖金、考勤/排班（最小实现先做“计件+提成+阶梯奖金”）

---

## 3. 数据模型（最少需要哪些表/对象）

### 3.1 站点（Station）

- `fuel_vehicles_per_day`：加油车辆/日（可输入）
- `visitor_vehicles_per_day`：访客车辆/日（默认很小）
- `traffic_volatility`：波动系数（例如 0.1 表示±10%）

### 3.2 业态/服务（ServiceLine）

每个业态给一组“可算账”的参数：

- `name`：自动洗车/人工洗车/综合汽服
- `price`：客单价（可细化为价格表）
- `conversion_from_fuel`：加油车转化率
- `conversion_from_visitor`：访客转化率
- `capacity_per_day`：日最大产能（自动洗车很高，人工/汽服受人手影响）
- `variable_cost_per_order`：单笔变动成本（耗材/水电气/易耗品）
- `part_cost_ratio`（可选）：综合汽服配件成本占比（或按 SKU/项目管理）
- `time_per_order_min`（可选）：用于把“人手→产能”挂钩

### 3.3 库存与耗材（Inventory）

最小实现建议先分两类：

- `耗材`（洗车液、毛巾损耗等）：按订单自动扣减，计入 COGS
- `配件`（机油、滤芯等）：可先用“成本率/单车材料成本”替代，后续再上 SKU

你提到“库存”关键点在于：

- 现金流：采购时现金减少
- 利润表：使用/销售时才确认成本（COGS）

### 3.4 资产与折旧（Assets）

- `capex`：购置/装修投入
- `useful_life_months`：折旧年限（月）
- `depr_method`：先做直线法
- `depr_per_day`：按日计提（= capex / useful_life_days）

### 3.5 人员与薪酬（Staff + Payroll）

角色建议（可按你业务改名）：

- `店长`：底薪 + 门店利润/毛利奖金（可阶梯）
- `洗车员`：底薪（可选）+ 计件（每单多少钱）+ 达标奖
- `技师`：底薪 + 工时/项目提成 + 毛利提成（综合汽服更贴合）
- `前台/收银`（可选）：底薪 + 销售提成

---

## 4. 计算逻辑（核心公式，先简单但要闭环）

### 4.1 每日订单量（按业态）

1) 计算今日车流：

- `fuel_today = fuel_vehicles_per_day * (1 + rand(-v, +v))`
- `visitor_today = visitor_vehicles_per_day * (1 + rand(-v, +v))`

2) 计算潜在订单：

- `potential = fuel_today * conv_fuel + visitor_today * conv_visitor`

3) 受产能限制的实际订单：

- `orders = min(potential, capacity_per_day)`

### 4.2 收入/成本/毛利

- `revenue = orders * price`
- `variable_cost = orders * variable_cost_per_order`（耗材/水电等）
- `gross_profit = revenue - variable_cost - parts_cogs`（parts_cogs 可先= revenue * part_cost_ratio）

### 4.3 人工成本（含“业务挂钩”）

建议把薪酬拆成三段，便于解释和扩展：

- `fixed_pay`：底薪/固定补贴（固定成本）
- `piece_rate`：计件（每单/每工时）
- `bonus`：阶梯奖金（与销量/毛利/利润挂钩）

人工成本日结：

- `labor_cost = fixed_pay_per_day + piece_rate_pay_today + bonus_today`

### 4.4 折旧与固定费用

- `depr_cost`：按日计提折旧
- `fixed_overhead`：水电底费、物业、系统费等（如确实存在）

### 4.5 利润与现金流（务必区分）

- `operating_profit = gross_profit - labor_cost - depr_cost - fixed_overhead`

现金流（最小实现）：

- `cash_in = revenue`
- `cash_out = 实际采购支出 + 发薪支出 + 固定费用支出 + capex 分期支出`
- `net_cashflow = cash_in - cash_out`

### 4.6 盈亏平衡（按“贡献毛利”口径）

对每个业态（或整体门店）计算：

- `unit_contribution = price - variable_cost_per_order - variable_labor_per_order`
- `fixed_cost_per_day = fixed_pay_per_day + depr_cost + fixed_overhead`
- `break_even_orders_per_day = fixed_cost_per_day / unit_contribution`

输出建议：

- BEQ（单量/日）
- BEQ 对应所需加油车流（反推）：`needed_fuel = break_even_orders / conv_fuel`
- 回本期（capex payback）：`capex / 日均经营现金流`（用最近 30 天滚动均值）

---

## 5. 薪酬体系（最小但“详细、可落地”）

### 5.1 洗车员（适配人工洗车/辅助自动洗车）

- 底薪：`base_monthly`
- 计件：`orders_manual * piece_per_manual + orders_auto_assist * piece_per_auto`
- 阶梯奖（按当日或当月）：
  - 当月人工洗车单量达到 `T1/T2/T3`，每档追加 `bonus1/bonus2/bonus3`

优点：简单、强绑定业务、易解释。

### 5.2 技师（综合汽服）

- 底薪：`base_monthly`
- 项目提成（按工单/项目）：例如 `换油`、`补胎`、`更换滤芯` 等每单固定提成
- 毛利提成（强绑定利润）：
  - `commission = max(0, gross_profit_service_line) * rate`
  - 或者按项目毛利计算：`(项目收入 - 配件成本 - 耗材成本) * rate`

### 5.3 店长

- 底薪：`base_monthly`
- 门店绩效：建议与“经营利润/经营现金流”挂钩（而不是仅收入）
  - `bonus = max(0, operating_profit_month) * manager_rate`
  - 可加门槛：利润>0 才发；或达到 BEQ 后开始计提

### 5.4 考勤/排班（最小实现方式）

先做“固定编制+固定出勤天数”，把复杂的排班留到后续：

- 每个角色配置 `headcount` 与 `workdays_per_month`
- 自动换算日成本：`base_monthly * headcount / workdays_per_month`

---

## 6. CLI 最少改动建议（你现有项目的升级点）

菜单建议（最少且贴业务）：

- `1) 配置/查看站点流量`（加油车/访客）
- `2) 配置服务线`（价格、转化率、产能、耗材成本）
- `3) 录入/调整库存采购`（可选，先只做耗材）
- `4) 配置薪酬方案`（底薪/计件/阶梯/毛利提成）
- `5) 建设/开业状态`（建设天数、CAPEX、折旧年限）
- `6) 过一天（日结）`
- `7) 报表（近 7/30 天、当月累计、盈亏平衡）`

---

## 7. 下一步我可以直接帮你落地的“最少升级包”

如果你确认要动代码，我建议第一版只加：

1) `自动洗车` + `人工洗车` 两条线（综合汽服先不做 SKU，只做“材料成本率”占位）
2) 薪酬：洗车员计件 + 店长利润提成（先不做技师细分）
3) 折旧：直线折旧 + 建设期 CAPEX
4) 盈亏平衡：按日输出 BEQ 与回本期

这样改动少，但能把“工资系统 + 盈亏平衡”这两块打牢。
