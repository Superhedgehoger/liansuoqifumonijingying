# 规划：加油站汽服门店（最小升级 + 后续路线图）

面向场景：依托加油站车流，建设汽服门店（自动洗车/人工洗车/综合汽服），以 **盈亏平衡** 为核心目标；客流不做复杂仿真；薪酬体系要与业务强绑定；成本核算要覆盖库存/耗材/折旧/人工等。

相关参考：

- 开源与选型参考：`C:\Users\DJY\Documents\OpencodePJ\连锁汽服经营模拟\开源参考-连锁经营.md`
- 详细最小方案（计算口径/薪酬细化）：`C:\Users\DJY\Documents\OpencodePJ\连锁汽服经营模拟\最小升级方案-加油站汽服.md`

---

## 一、目标与边界

### 目标（先把账算清）

- 能模拟“建设→开业→日结/月结→盈亏平衡→回本期/关停”的闭环
- 利润表与现金流分离（采购/折旧/计提口径清晰）
- 薪酬体系可配置，且与销量/毛利/利润挂钩

### 暂不做（避免复杂度爆炸）

- 省级真实 GIS、复杂客流仿真、竞争门店博弈
- 复杂排班系统（先做固定编制/固定出勤天数换算）
- 综合汽服的完整 SKU/配件仓（先用“材料成本率/单车材料成本”占位）

---

## 二、最小升级方案（v0.2，推荐先做）

范围：**单站点**、可选 **两条洗车业态**（自动洗车 + 人工洗车），综合汽服先占位。

### 2.1 功能清单（闭环必需）

- 站点流量：输入 `加油车辆/日`（访客可选）+ 简单波动
- 服务线：价格、转化率、产能、单笔耗材成本（变动成本）
- 建设期：CAPEX（设备/装修/押金等）+ 建设天数 + 开业状态机
- 折旧：直线法按日计提（设备/装修）
- 库存/耗材（最小）：耗材采购（现金流出）+ 按订单扣减（COGS）
- 薪酬（最小但可用）：
  - 洗车员：底薪（可选）+ 计件 + 阶梯奖
  - 店长：底薪 + 利润/毛利提成（带门槛：利润>0 或过 BEQ 才发）
- 报表：
  - 日报：订单/收入/毛利/人工/折旧/净利润/经营现金流
  - 月报：汇总 + BEQ + 回本期（滚动均值）

### 2.2 核心计算口径（最小实现）

- 订单（按业态）：
  - `potential = fuel_today * conv_fuel + visitor_today * conv_visitor`
  - `orders = min(potential, capacity_per_day)`
- 毛利：`revenue - variable_cost(耗材/水电) - parts_cogs(占位)`
- 利润：`毛利 - 人工(底薪+计件+奖金) - 折旧 - 固定费`
- 现金流：收入入账 vs 采购/发薪/CAPEX 支出分开记
- 盈亏平衡（贡献毛利法）：
  - `unit_contribution = price - variable_cost - variable_labor_per_order`
  - `BEQ_orders = fixed_cost_per_day / unit_contribution`

### 2.3 CLI 最小菜单建议

- 配置站点流量
- 配置服务线
- 采购耗材/查看库存
- 配置薪酬方案
- 配置建设与资产折旧
- 过一天（日结）
- 报表（近 7/30 天、当月、BEQ/回本）

---

## 三、日后规划（路线图）

### v0.3（把“薪酬系统”做完整）

- 引入角色体系：店长/洗车员/技师/前台（可选）
- 计薪规则模板化：
  - 计件（按单/按工时）
  - 销售提成（按收入）
  - 毛利/利润提成（按毛利或经营利润）
  - 阶梯奖金（按销量/毛利/利润阈值）
- 考勤与出勤天数：固定编制→可配置缺勤/加班系数（仍不做复杂排班）
- 薪资报表：人均产出、人工率（人工/收入、人工/毛利）、绩效达标情况

### v0.4（把“综合汽服”跑通）

- 工单/项目：换油/补胎/滤芯等项目表
- 材料成本：从“成本率占位”升级为“项目耗材/配件成本”
- 技师提成：按项目/按工时/按项目毛利提成
- 产能约束：人手→工时→可接单量（把业务与人员规模真正耦合）

### v0.5（多站点/连锁视角，但仍轻量）

- 多站点资产与现金池（总部资金 vs 门店资金口径可选）
- 开店流水线：选点→预算→建设→开业→爬坡（转化率/客单逐步稳定）
- 关店/迁址：沉没成本处理（资产处置、剩余折旧、库存清理）

### v0.6+（需要时再引入的“重能力”）

## 五、当前实现状态（已落地）

- 已完成到 v0.6（轻量版选址/扩张推荐 + 多站点/多门店 + 关店处置 + 综合汽服项目/配件库存 + 薪酬体系）
- WebUI 已提供完整编辑能力：站点、门店属性、服务线、项目目录、薪酬角色、库存采购、资产/折旧、关店处置
- 数据导出与持久化：`data/state.json`（存档）与 `data/ledger.csv`（流水）

- 选址优化：引入 `spopt/MCLP/p-center` 之类做候选点推荐
- 真实地图：`osmnx + networkx` 用路网可达性替代简单半径
- 行为仿真：`mesa` 做顾客选择/分流（仅在你确实要“非加油客流”时再上）

---

## 四、落地优先级（建议）

1) v0.2：把利润表/现金流/折旧/库存耗材/BEQ 跑通（最关键）
2) v0.3：把薪酬体系模板化（你明确要求“详细且与业务挂钩”）
3) v0.4：再把综合汽服按工单做实（引入技师、工时、材料成本）
4) v0.5：最后才做连锁扩张与开关店策略
